# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a Perl-based bioinformatics database system consisting of two main components:

1. **DATABASE/**: Perl scripts for converting spreadsheet data to SQL database format
2. **SequencesDB/**: Catalyst web application for managing DNA sequence libraries

## Common Development Commands

### SequencesDB Web Application

```bash
# Start development server
cd SequencesDB
perl script/sequencesdb_server.pl

# Run tests
perl -Ilib t/01app.t
perl -Ilib t/controller_Library.t
perl -Ilib t/model_DB.t
perl -Ilib t/view_TT.t

# Build/install dependencies
perl Makefile.PL
make
make test
make install
```

### Database Scripts

```bash
# Convert spreadsheet to database format
cd DATABASE
perl sql_final.pl "spreadsheet_filename.txt"

# Insert file paths and SHA2 keys
perl file_path.pl "list_fastq_files.txt"
```

## Architecture

### SequencesDB Web Application Structure

- **MVC Pattern**: Built on Catalyst framework using Model-View-Controller architecture
- **Models**: Database abstraction layer using DBIx::Class ORM
  - `SequencesDB::Schema` - Main database schema
  - Result classes in `Schema/Result/` define database tables (Library, File, Organism, etc.)
  - ResultSet classes in `Schema/ResultSet/` contain custom query methods
- **Controllers**: Handle HTTP requests and business logic
  - `Controller::Library` - Main controller for library management (search, create, edit)
  - `Controller::Root` - Root controller for basic routing
- **Views**: Template processing using Template Toolkit
  - `View::HTML` - HTML template processor
  - Templates in `root/src/` directory

### Database Schema

The database tracks DNA sequence libraries with relationships to:
- **Library**: Central table with SHA2 keys, repeat/replicate info
- **File**: File paths and names linked to libraries
- **Organism, Tissue, Cell**: Biological context
- **Experiment, Background, Method**: Experimental conditions  
- **Antibody, Sequencer, ReadType**: Technical details

### Key Features

- **Search functionality**: Advanced search with multiple filters
- **Library management**: Create, edit, and track sequence libraries
- **File tracking**: SHA2-based file identification with path management
- **Duplicate detection**: Prevents duplicate libraries based on SHA2 keys
- **Batch import**: Spreadsheet-to-database conversion tools

## Data Flow

1. Spreadsheet data → `sql_final.pl` → Database insertion
2. File paths → `file_path.pl` → SHA2 key generation and file tracking
3. Web interface → Library controller → Database operations → Template display

## Development Notes

- Database schema is auto-generated by DBIx::Class::Schema::Loader
- The application uses Moose for object-oriented Perl
- Configuration stored in `sequencesdb.conf`
- Static files served from `root/static/`
- Templates use Template Toolkit (.tt2 files)